# Reversing Malicious Code
- **Goal is to understand common malware characteristics at a code level**
- May include potential branches of execution with code analysis 

- **Overview of the code lifecycle**
- Source code is translated into object code by a compiler
- Object code is then combined with librries and an executable file is created
- To run the file, the operating system reads various information from the executable file, allocates memory, and loads required libraries into memory
- Control is transfered to the code to execute
- At this final stage is where we examine the code with a debugger
- Note: Libraries may be loaded during the programs execution 

## Ghidra 
- Developed by NSA
- Its decompiler produces a C representation of the code to speed up analysis 
- Includes support for writing java and python scripts to automate analysis 
- Help is accessed via F1 key 
- Ghidra v10 includes a debugger
- https://for610.com/ghidra
#### Create a new project 
- `File --> New Project`
- Choose the project type 
- Click `Finish`
- Drag and drop the speciment into the project window
- Accept defaults in the `Imports` windows and click Ok
#### Launch the code browser and being the auto-analysis 
- Make sure to enable `WindowsPE x86 Propagate Exernal Parameters` option
- Finally click the Analyze button and wait for Ghidra to finish 
- Once auto analysis is compled an Auto Analysis summary will show any warnings or issues encountered during the rocess 
- A common warning is that the file does not `contain debug information` 
- This is common and not an issue 

#### Before Proceeding save the project and take a snapshot 
### Ghidra Overview 
- Main window is the `Listing View` which presents the target programs coe and data 
- Will initially bring you to the beginning of the file in the `Listing View` --> notice the `MZ` string
- If you scroll down from there you can examine the programs header

#### Program Tree 
- Window is in the top left and shows the different sections and headers 
- Section names are typically:
````
.text - Contains executable code
.rdata - Contains read-only data
.data - Contains data 
.reloc - Contains relocation data to fix up addresses in the file if it is not loaded at the prefered address
````
- To jump to the `.text` section double click the `.text` node 
- https://for610.com/peformat

- **FUN in Ghidra**
- In Ghidra the `FUN_` prefix generically refers to a function while the numeric value refers to the address where the function is loaded into memory
- Origional name of the function is normally lost during compilation 
- Execution occurs linearly one instruction after the next
- On the far left you will have a 32 bit address such as `00401007` (hex) 
- This affress represents the location of code in memory after the program is loded, not the address of a location on disk i.e. within a file hex editor 
- On the right there are x86 assembly instructions 
- **Note:** - This is the beginning of the `.text` section, not the beginning of the program, that occurs at the entry point 

#### Function graph view provides a visul perspective on code
- Click on the function you want i.e. `FUN_00401007`
- Browse to `Window --> Function Graph` menu item 
- Helpful for visualizing loops and complex conditionals within a function but the `Listing view` is more compact nd easier for some people to navigate 
- **The color of the arrows symbolize code flow**
- If the code block ends in a conditionl jump green arrows indicate the pth here execution will continue if the condition is met
- If the condition is not met a red arrow will show where execution continues 
- If the arrow is blue the clode ends in an unconditionl jump

































































































