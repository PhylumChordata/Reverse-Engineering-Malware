# msdsrv.exe 
## Static Properties Analysis 
- Hashes
````
md5,75D15D4CCBE37019283C452012345074
sha1,BF72EC64682F7DBD9FA8AA629971D28BE1FC23F6
sha256,EF2D290A0B2CA89C9A70011414AFCA3CFA7605A07912753B8B109283B4110C98
````
- Basic Values 
````
file-size,328704 (bytes)
entropy,5.876
file-type,executable
cpu,32-bit
````
- Two Level 1 Indicators 
````
The file references string(s),type: blacklist, count: 57,1
The file imports symbol(s),type: blacklist, count: 26,1
````
- Sections are normalL `.text, .rdata, .data, .rsrc, .reloc` --> sample does not appear to be packed at this time
- Only the `.text` section is executable 
- `.rdata` section is writable 
- Libraries Used (12)
````
kernel32.dll
user32.dll
advapi32.dll
shell32.dll
ole32.dll
shlwapi.dll
wininet.dll
oleacc.dll
gdi32.dll
winspool.drv
comdlg32.dll
oleaut32.dll
````
- Imports (264) --> Sample is for sure not packed, can see cleartext library names and all of them
- Interesting Imports 
````
CreateWindowExA
GetVersionExA
IsDebuggerPresent
GetLocalTime
GetTimeZoneInformation
GetComputerNameA
GetUserNameA
HttpOpenRequestA
InternetConnectA
HttpSendRequestExA
HttpEndRequestA
InternetReadFile
InternetWriteFile
InternetSetFilePointer
InternetSetStatusCallback
InternetOpenA
InternetQueryDataAvailable
HttpAddRequestHeadersA
InternetCloseHandle
InternetGetLastResponseInfoA
LocalAlloc
GlobalReAlloc
VirtualAlloc
HeapCreate
VirtualFree
GetStringTypeA
GetStringTypeW
CallNextHookEx
SetWindowsHookExA
UnhookWindowsHookEx
ReadFile
WriteFile
CreateFileA
TlsGetValue
TlsAlloc
TlsSetValue
TlsFree
GetCommandLineA
ExitProcess
FreeEnvironmentStringsA
GetEnvironmentStrings
FreeEnvironmentStringsW
Sleep
PostQuitMessage
PostMessageA
OpenClipboard
GetClipboardData
CloseClipboard
WriteConsoleA
WriteConsoleW
````
- Interesting Strings (2103)
````
14.8.1.6
13.9.6.11
POST
DELETE
CLSID\%1
CLSID\%1\ProgID
GetKeyState
GetAsyncKeyState
%s (%s:%d)
%s (%s:%d)
Excep while up %s: %s
http://
HTTP/1.0
%2\protocol\StdFileEditing\verb\0
InitCommonControls
InitCommonControlsEx
HtmlHelp
F#32768
commctrl_DragListMsg
CCmdTarget
MessageBox
"dssds";
"%s"
A_u^?C^alrn/ill
{ClipBoard Data:
-----------------------------------------------------------------------
Title of Windows
#!"q(#%TB;<>;3792+-52+19:3<?407C+(*MQKFan`\
````
## Behavioral Analysis 
- Key Takeaways so far, API pattern of:
````
GetKeyState --> Retrieves the status of a specified key.
GetAsyncKeyState --> Determines if a key is currently up or down, or if it was pressed since the last call to the API
GetWindowText --> Obtains the text of a windows title bar, combined with the previous two APIs an attacker could learn about what window the user is in plus the keys pressed.
OpenClipBoard --> get access to the clipboard and also make sure the application does not make changes to it
GetClipBoardData --> gathers data from the clipboard
CloseClipBoard --> self explanitory 
````
- Set up fakedns, wireshark and execute sample 
- ![image](https://user-images.githubusercontent.com/75596877/181640770-c9563c46-e3d5-4c08-962c-66ebf503c5e6.png)
- Sample stays in the process tree, however makes no call outs to remote IPs
- ![image](https://user-images.githubusercontent.com/75596877/181640901-9b12eaa7-7142-4c20-b655-74a7e89b69c4.png)
- ![image](https://user-images.githubusercontent.com/75596877/181640927-993726c3-c9b1-4ac7-8c28-8826d15e10b8.png)
- File executes with multiple threads 
- ![image](https://user-images.githubusercontent.com/75596877/181641174-a780e990-f2b1-4019-ba71-6c95713d2252.png)
- 





















