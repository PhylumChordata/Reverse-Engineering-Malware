# Malware Analysis Fundamentals 
- Malware: code that is used to perform malicious actions.

### Malware Analysis Goals
- Assess the nature of malware threats
- Determine the scope of the indicdent
- Eradicate malicious artifacts
- Strengthen your ability to handle malware incidents 

- Stages of malware analysis techniques increase in complexity 
- Most Complex:
- Manual Code Reversing
- Interactive Behavior analysis 
- Static Properties analysis
- Fully automated analysis 

## Static Properties Analysis 
- Static properties are also called metadata 
- Entails examinin gthe strings embedded into the file
- Overall file structure
- Header data
- Does not include running the actual file 
- Automated and static analysis allow an analyst to justify allocating additional time to taking a closer look at the specimen 

## Interaction with other Infosec Professions
- <strong>Input to REM staff</strong>
- Verbal reports
- Suspicious files
- File system image 
- Memory image
- Network Logs
- Anomaly observations 
- <strong>Output from REM staff</strong>
- What malware does
- How to identify it
- Attackers profile 
- IR recommendations
- Reports and IOCs
- Malware trends 

### What to include in a malware analysis report 
- Determine how detailed and formal the output of your malware analysis needs to be 
- If a formal report is needed:
- **Summany of the analysis:** Key takeaways the reader should get from the report regarding the specimens nature, origin, caabilities, and other relavant characteristics
- **Identification:** The type of file, its name, size, and hashes, malware name, and current antivirus detection capabilities
- **Characteristics:** The specimens capabilities for infecting files, self-preservation, spreading, leaking data, interacting with the attacker
- **Dependencies:** Files and network resources related to the specimens functionality such as supported OS version and required initialization files, custom DLLs, executables, URLs, and scripts
- **Behavioral and code analysis findings:** Overview of the analysts behavioral, as well as static and dynamic code analysis observations
- **Supporting Figures:** Logs, screenshots, string excerpts, function listings, and other exhibits that support the investigators findings
- **Incident recommendations:** Indicators for detecting the speciment on other systems and networks, and possible for eradication steps
#### Templates 
- https://github.com/MAECProject/schemas/wiki/Malware-Capabilities
- https://github.com/MBCProject/mbc-markdown
[Malware_Analysis_Template.docx](https://github.com/jtaubs1/Reverse-Engineering-Malware/files/8701238/Malware_Analysis_Template.docx)

## Open Source Malware Research
- **Malware data repositories:** VT, #totalhash
- **Multi-engine antivirus scanners:** VT, MetaDefender, VirSCAN, AVCaesar
- **File Reputation:** Malware Hash Registry, Hashsets, Windindex
- **Automated sandboxes:** Any.run, CAPE, Intezer Analye, Hybrid Analysis
- **Website investigation:** vURL, Quttera, urlscan.io
- **Other threat intelligence:** Shodan, Open Threat Exchange, RiskIQ Community Edition 

### Dont use your normal internet connection when interacting with sites outside your lab during the investigation
- Tor is a reasonable option, but adversaries can track exit nodes
- Commercial VPN services can work `www.for610.com/algo`
- Set up your own VPN in the cloud 
- Remember to check for DNS leakage in the case the adversary is checking authoritative DNS server logs for malicious domains
- You could also deploy a transient lab in a public cloud
- **Note:** Check for DNS leakage `www.for610.com/dnsleak`

### Self Defending Malware
- Malware might include self defending capabilities
- Detect virtualization, monitoring, analysis tools
- Detect or confuse code analysis tools such as debuggers or disassemblers 
- **If it detects its being analyzed it might**
- Terminate itself
- Put itself to sleep
- Interfere with analysis tools
- Exhibit different characteristics

- **There are ways to deal with malware that detects analysis tools**
- Could use physical system
- Clone a clean parition with Clonezilla, FOG, and dd
- Store the clean copy away from the system you are infecting 
- At the end of the analysis restore the infected partition with the clean copy
- Can also restore the clean image over the network with PXE booting
- **Instructions** https://for610.com/cape-fog

- **The Lab should include tools that can examine the sample statically and dynamically**
- **Static Properties Analysis** - PeStudio, strings, CFF Explorer, peframe, Detect It Easy, etc
- **Behavioral Analysis** - Process Hacker, Process Monitor, RegShot, Wireshark, fakedns, etc
- **Code Analysis** - Ghidra, x64db/x32db, OllyDumpEx, runsc, Scylla, etc

## Static Properties Analysis 
brbbot-analysis.md



















